---
- name: make sure book_volume exists
  file:
    path: "{{ book_volume }}"
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"
    mode: 0755
  become: yes

- name: create persistent config dir for ebooks
  file:
    path: "{{ config_volume }}/books"
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"
    mode: 0755
  become: yes

- name: start ubooquity container
  docker_container:
    name: books
    image: linuxserver/ubooquity:latest
    state: started
    restart: yes
    restart_policy: always
    labels:
      traefik.enable: "false"
      launchpanel.enabled: "yes"
      launchpanel.ip: "{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }}"
      launchpanel.name: "books"
      launchpanel.port: "8202"
    ports:
      - 8202:2202
      - 8303:2203
    env:
      TZ: America/Chicago
      PUID: 1000
      PGID: 1000
    volumes:
      - "{{ book_volume }}/books:/books"
      - "{{ book_volume }}/comics:/comics"
      - "{{ book_volume }}/files:/files"
      - "{{ config_volume }}/ebooks:/config"