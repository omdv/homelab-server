---
- name: create persistent dir for nginx
  file:
    path: "{{ config_volume }}/nginx"
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"
    mode: 0755

- name: copy static file
  copy:
    src: index.html
    dest: "{{ config_volume }}/nginx/index.html"
    user: "{{ user }}"
    group: docker
    force: yes

- name: start nginx container
  docker_container:
    name: nginx
    state: started
    restart: yes
    restart_policy: always
    labels:
      traefik.enable: "true"
      traefik.port: "80"
      traefik.frontend.rule: "Host:e2.pe"
    image: nginx:1.15-alpine
    # healthcheck:
    #   test: ["CMD", "curl", "--fail", "http://localhost:80"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3
    #   start_period: 30s
    volumes:
      - "{{ config_volume }}/nginx/:/usr/share/nginx/html:ro"