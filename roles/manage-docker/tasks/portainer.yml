---
- name: create directory for portainer
  file:
    path: "{{ config_volume }}/portainer"
    state: directory
    owner: "{{ user }}"
    group: docker
    mode: 0755

- name: start portainer container
  docker_container:
    name: portainer
    state: started
    restart: yes
    restart_policy: always
    ports:
      - 9000:9000
    labels:
      traefik.enable: "false"
      launchpanel.enabled: "yes"
      launchpanel.ip: "{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }}"
      launchpanel.name: "portainer"
      launchpanel.port: "9000"
    image: portainer/portainer:latest
    volumes:
      - "{{ config_volume }}/portainer:/data"
      - /var/run/docker.sock:/var/run/docker.sock

- name: start watchtower container
  docker_container:
    name: watchtower
    state: started
    restart: yes
    restart_policy: always
    networks:
      - name: bridge
    labels:
      traefik.enable: "false"
    image: v2tec/watchtower:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock