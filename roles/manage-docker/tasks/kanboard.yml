---
- name: create persistent dir for kanboard
  file:
    path: "{{ config_volume }}/kanboard"
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"
  become: true

- name: create persistent dir for data
  file:
    path: "{{ config_volume }}/kanboard/data"
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"
  become: true

- name: create persistent dir for plugins
  file:
    path: "{{ config_volume }}/kanboard/plugins"
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"
  become: true

- name: start kanboard container
  docker_container:
    name: kanboard
    state: started
    restart: true
    restart_policy: always
    image: kanboard/kanboard:latest
    volumes:
      - "{{ config_volume }}/kanboard/data:/var/www/app/data"
      - "{{ config_volume }}/kanboard/plugins:/var/www/app/plugins"
    labels:
      traefik.enable: "false"
      launchpanel.enabled: "yes"
      launchpanel.ip: "{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }}"
      launchpanel.name: "kanboard"
      launchpanel.port: "8012"
    ports:
      - 8012:80
