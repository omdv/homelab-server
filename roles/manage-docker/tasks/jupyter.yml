---
- name: create persistent dir for jupyter config
  file:
    path: "{{ config_volume }}/jupyter"
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"
  become: yes

- name: create persistent dir for jupyter storage
  file:
    path: "{{ jupyter_volume }}"
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"
  become: yes

# - name: launch GPU jupyter container
#   shell: docker run -d --gpus all --ipc=host \ 
#     -p 8007:8888 \
#     --name jupyter \
#     --label launchpanel.enabled=yes \
#     --label launchpanel.ip=192.168.0.24 \
#     --label launchpanel.name=jupyter \
#     --label launchpanel.port=8007 \
#     -v /pool/jupyter:/data \
#     -v /pool/config/jupyter:/config \
#     omdv/deepo:10.2 \
#     jupyter-lab --no-browser --ip=0.0.0.0 --allow-root --NotebookApp.token= --notebook-dir='/data'

# - name: start jupyter container
#   docker_container:
#     name: jupyter
#     image: jupyter/scipy-notebook:latest
#     state: started
#     restart_policy: always
#     command: start.sh jupyter lab --LabApp.token=''
#     labels:
#       launchpanel.enabled: yes
#       launchpanel.ip: 192.168.0.24
#       launchpanel.name: jupyter
#       launchpanel.port: 8006
#       traefik.enable: true
#       # traefik.http.routers.jupyter.rule: Host(`jpt.${TLD}`)
#       # traefik.http.middlewares.https_redirect.redirectscheme.scheme: https
#       # traefik.http.routers.jupyter.middlewares: https_redirect
#       # traefik.http.routers.jupyter-secured.tls
#       # traefik.http.routers.jupyter-secured.rule: Host(`jpt.${TLD}`)
#       # traefik.http.routers.jupyter-secured.tls.certresolver: mytls
#       # traefik.http.routers.jupyter-secured.entrypoints: https
#       # traefik.http.middlewares.auth.forwardauth.address: http://traefik-forward-auth:4181
#       # traefik.http.middlewares.auth.forwardauth.trustForwardHeader: true
#       # traefik.http.middlewares.auth.forwardauth.authResponseHeaders: X-Forwarded-User
#       # traefik.http.routers.jupyter-secured.middlewares: auth@docker
#     volumes:
#       - "{{ config_volume }}/jupyter:/home/jovyan/"
#     ports:
#       - 8006:8888