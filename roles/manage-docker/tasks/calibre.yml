---
- name: create persistent dir for calibre
  file:
    path: "{{ config_volume }}/calibre"
    state: directory
    owner: "{{ user }}"
    group: "{{ user }}"
  become: yes

- name: start calibre-rdp container
  docker_container:
    name: calibre-rdp
    state: started
    restart: yes
    restart_policy: always
    ports:
      - 12080:8080
    labels:
      traefik.enable: "false"
      launchpanel.enabled: "yes"
      launchpanel.ip: "{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }}"
      launchpanel.name: "calibre-rdp"
      launchpanel.port: "12080"
    image: aptalca/docker-rdp-calibre:latest
    volumes:
      - "{{ config_volume }}/calibre:/config"
    env:
      TZ: America/New_York
      EDGE: "0"
      WIDTH: "1280"
      HEIGHT: "720"

- name: start calibre-web container
  docker_container:
    name: calibre-web
    state: started
    restart: yes
    restart_policy: always
    ports:
      - 8083:8083
    labels:
      traefik.enable: "false"
      launchpanel.enabled: "yes"
      launchpanel.ip: "{{ hostvars[inventory_hostname]['ansible_default_ipv4']['address'] }}"
      launchpanel.name: "calibre-web"
      launchpanel.port: "8083"
    image: linuxserver/calibre-web:latest
    volumes:
      - "{{ config_volume }}/calibre/config/books:/books"
      - "{{ config_volume }}/calibre:/config"
    env:
      TZ: America/New_York
      PUID: 1000
      PGID: 1000